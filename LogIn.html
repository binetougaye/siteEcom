<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="Authentification.css">
    <title>LogIn Page</title>
</head>

<body>
<!-- ===============================FORMILAIRE DE CONNEXION================================= -->
<div class="container">
    <div class="row col-md-5 mx-auto mt-5">
        <form action="" id="loginForm" name="loginForm">
            <div class="text-head">
                <h3>S'identifier</h3>
            </div>
            <div class="form-floating mb-3">
                <input type="email" class="form-control" id="email" placeholder="name@example.com">
                <label for="email">Your Email address</label>
            </div>
            <div class="form-floating mb-3">
                <input type="password" class="form-control" id="password" placeholder="Password">
                <label for="password">Your Password</label>
            </div>
            <button type="submit" class="btn btn-primary w-100 mx-auto mb-3">Continuer</button>

            <p>
                En continuant, vous acceptez les <a href="/">conditions d'utilisation et de vente</a> de belle gueule.
                Consultez notre <a href="/">déclaration de confidentialité</a>, <a href="/">notre politique relative aux cookies</a>
                ainsi que notre <a href="/">politique relative aux publicités ciblées par centres d’intérêts</a>.
            </p>
            <div class="accordion accordion-flush mb-3" id="accordionFlushExample">
                <div class="accordion-item">
                  <h2 class="accordion-header">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseOne" aria-expanded="false" aria-controls="flush-collapseOne">
                      Avez-vous besoins d'aide ?
                    </button>
                  </h2>
                    <div id="flush-collapseOne" class="accordion-collapse collapse" data-bs-parent="#accordionFlushExample">
                        <a href="ForgetPassword.html">Mot de passe oublié ?</a>
                        <a href=" ">Autres choses ?</a>
                    </div>
                </div>
            </div>
        </form>
        <a href="SignIn.html"><input type="text" class="form-control" value="Créer votre compte sur Belle Gueule"></a>

    </div>
</div>





<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getDatabase, ref, get, child } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";
    import { getAuth, signInWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
       
        const firebaseConfig = {
          apiKey: "AIzaSyCyo7of9VPNbQqtBN3VYJL3ZJM-qFyDZKY",
          authDomain: "validation-javascript.firebaseapp.com",
          projectId: "validation-javascript",
          storageBucket: "validation-javascript.appspot.com",
          messagingSenderId: "944265527624",
          appId: "1:944265527624:web:0853d33f7d2aa2eadaf37d",
          measurementId: "G-JCXC8B27KG"
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase();
        const auth = getAuth(app);
        const dbref = ref(db)
        
        
        let email = document.getElementById("email")
        let password = document.getElementById("password")
        let loginForm = document.getElementById("loginForm")

// function pour la connexion des admins

        let signInUser = evt =>{
            evt.preventDefault();

            signInWithEmailAndPassword(auth, email.value, password.value)
            .then((credentials)=>{
                get(child(dbref, 'UserAuthList' + credentials.user.uid)).then((snapshot)=>{
                    if (snapshot.exists) {
                        sessionStorage.setItem("user-info", JSON.stringify({
                            Name: snapshot.val().Name,
                            lastname: snapshot.val().lastname
                        }))

                        sessionStorage.setItem("user-creds", JSON.stringify(credentials.user));
                        window.location.href = 'test.html'
                    }
                });
            })
            .catch((error)=>{
                alert(error.message);
                console.log(error.code);
                console.log(error.message);
            })
        }

        loginForm.addEventListener('submit', signInUser);
</script>

  <!-- BOOTSATRAP LINK  -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" crossorigin="anonymous"></script>
</body>
</html>